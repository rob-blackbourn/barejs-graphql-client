var barejsGraphQlClient=function(e){"use strict";class t extends Error{constructor(e,...r){super(...r),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.name="FetchError",this.response=e}}class r extends Error{constructor(e,...t){super(...t),Error.captureStackTrace&&Error.captureStackTrace(this,r),this.details=e}}class s extends Error{constructor(e,...t){super(...t),Error.captureStackTrace&&Error.captureStackTrace(this,s),this.event=e}}const n="connection_init",o="connection_ack",a="connection_error",c="ka",i="start",l="stop",u="connection_terminate",h="data",p="error",b="complete";class d{constructor(e,t,r,o="graphql-ws"){this.callback=r,this.nextId=1,this.subscriptions=new Map,this.webSocket=new WebSocket(e,o),this.webSocket.onopen=e=>{this.webSocket.send(JSON.stringify({type:n,payload:t}))},this.webSocket.onclose=e=>{const t=1e3===e.code||1005===e.code?null:new s(e);this.callback(t);const r=Array.from(this.subscriptions.values());this.subscriptions.clear();for(const e of r)e(t,null)},this.webSocket.onmessage=this.onMessage.bind(this)}subscribe(e,t,r,s){const n=(this.nextId++).toString();return this.subscriptions.set(n,s),this.webSocket.send(JSON.stringify({type:i,id:n,payload:{query:e,variables:t,operationName:r}})),()=>{this.subscriptions.delete(n),this.webSocket.send(JSON.stringify({type:l,id:n}))}}shutdown(){this.webSocket.send(JSON.stringify({type:u})),this.webSocket.close()}onMessage(e){const t=JSON.parse(e.data);switch(t.type){case o:this.callback&&this.callback(null,this.subscribe.bind(this));break;case a:this.callback&&this.callback(new r(t.payload),this);break;case c:break;case h:{const e=this.subscriptions.get(t.id);if(e){e(t.payload.errors?new r(t.payload.errors):null,t.payload.data)}break}case p:{const e=this.subscriptions.get(t.id);e&&e(new r(t.payload),null);break}case b:{const e=this.subscriptions.get(t.id);e&&(this.subscriptions.delete(t.id),e(null,null));break}}}}function f(e,t,r,s,n,o,a){let c=null;const i=new d(e,{},((e,i)=>{e||i?e?o(e):c=i(t,r,s,((e,t)=>{e||i?n({data:t,errors:e}):a()})):a()}),"graphql-ws"),l=i.shutdown.bind(i);return()=>{null!==c&&c(),l()}}function S(e,r,s,n,o,a,c,i){const l=new AbortController;return fetch(e,{method:"POST",signal:l.signal,body:JSON.stringify({query:s,variables:n,operationName:o}),...r}).then((e=>{if(200===e.status)e.json().then((e=>{a(e),i()})).catch((e=>c(e)));else if(201===e.status){const t=e.headers.get("location"),r=t.indexOf("?"),u=f("ws"+t.slice(4,-1===r?void 0:r),s,n,o,a,c,i);l.signal.onabort=()=>{u()}}else c(new t(e,"Failed to execute GraphQL"))})).catch((e=>{c(e)})),()=>{l.abort()}}return e.FetchError=t,e.graphqlClient=S,e.graphqlEventSourceClient=function(e,r,s,n,o,a,c,i){const l=new AbortController;return fetch(e,{method:"POST",signal:l.signal,body:JSON.stringify({query:s,variables:n,operationName:o}),...r}).then((e=>{if(200===e.status)e.json().then((e=>{a(e),i()})).catch((e=>c(e)));else if(201===e.status){const t=e.headers.get("location"),r=new EventSource(t);r.onmessage=e=>{const t=JSON.parse(e.data);a(t)},r.onerror=e=>{c(e)},l.signal.onabort=()=>{2!==r.readyState&&(r.close(),i())}}else c(new t(e,"Failed to execute GraphQL"))})).catch((e=>c(e))),()=>{l.abort()}},e.graphqlEventSourceSubscriber=function(e,t,r,s,n,o,a){let c=e+"?query="+encodeURIComponent(t);r&&(c+="&variables="+encodeURIComponent(JSON.stringify(r))),s&&(c+="&operationName="+encodeURIComponent(s));const i=new EventSource(c);i.onmessage=e=>{const t=JSON.parse(e.data);n(t)},i.onerror=e=>{o(e)};const l=new AbortController;return l.signal.onabort=()=>{2!==i.readyState&&(i.close(),a())},l.abort},e.graphqlFetchClient=function(e,r,s,n,o,a,c){fetch(e,{method:"POST",body:JSON.stringify({query:s,variables:n,operationName:o}),...r}).then((e=>{e.ok?e.json().then((e=>{c(e)})).catch((e=>a(e))):a(new t(e,"Failed to execute GraphQL"))})).catch((e=>a(e)))},e.graphqlStreamClient=function(e,t,r,s,n,o,a,c){const i=JSON.stringify({query:r,variables:s,operationName:n}),l="POST",u=new AbortController;return fetch(e,{method:l,headers:new Headers({allow:l,"content-type":"application/json",accept:"application/json",...(t||{}).headers}),mode:"cors",body:i,signal:u.signal,...t}).then((e=>{if(200===e.status){const t=new TransformStream({start(e){e.buf="",e.pos=0},transform(e,t){for(t.buf+=e;t.pos<t.buf.length;)if("\n"===t.buf[t.pos]){const e=t.buf.substring(0,t.pos);""!==e&&t.enqueue(e),t.buf=t.buf.substring(t.pos+1),t.pos=0}else++t.pos},flush(e){0!==e.pos&&e.enqueue(e.buf)}}),r=function(e,t,r){return new WritableStream({write(t,r){e(t)},close(e){r()},abort(e){"AbortError"===e.name?r():t(e)}})}(o,a,c);e.body.pipeThrough(new TextDecoderStream).pipeThrough(t).pipeThrough(new TransformStream({transform(e,t){t.enqueue(JSON.parse(e))}})).pipeTo(r).catch((()=>{}))}else a(new Error("Unhandled response"))})).catch((e=>{a(e)})),()=>u.abort()},e.graphqlWsClient=S,e.graphqlWsSubscriber=f,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=index.min.js.map
